<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.4.1"/><style data-href="/styles.9e907bc32054b7771552.css" data-identity="gatsby-global-css">code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#ccc;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}</style><link rel="sitemap" type="application/xml" href="/sitemap-index.xml"/><link rel="canonical" href="https://dev0wner.pro/2022-11-25-mwaa-xcom_backend-config/" data-baseprotocol="https:" data-basehost="dev0wner.pro"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion="css flq1iw">.css-flq1iw{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;height:100%;}</style><main class="css-flq1iw"><style data-emotion="css-global 1vr0iip">@import url('https://fonts.googleapis.com/css2?family=Nanum+Myeongjo:wght@400;700;800&display=swap');*{padding:0;margin:0;box-sizing:border-box;font-family:'Nanum Myeongjo',serif;}html,body,#___gatsby{height:100%;}a,a:hover{color:inherit;-webkit-text-decoration:none;text-decoration:none;cursor:pointer;}</style><style data-emotion="css a6j9j1">.css-a6j9j1{position:relative;width:100%;height:400px;}@media (max-width: 768px){.css-a6j9j1{height:300px;}}</style><div class="css-a6j9j1"><style data-emotion="css 14ujruu">.css-14ujruu{z-index:-1;width:100%;height:400px;object-fit:cover;-webkit-filter:brightness(0.25);filter:brightness(0.25);}@media (max-width: 768px){.css-14ujruu{height:300px;}}</style><div data-gatsby-image-wrapper="" style="position:absolute" class="gatsby-image-wrapper gatsby-image-wrapper-constrained css-14ujruu"><div style="max-width:768px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;402&#x27; width=&#x27;768&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><img aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear" decoding="async" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABM0lEQVR42q2M226CQBiE9/3foVdNKsvJQmpiBUpRhBWx2iKyWE5t+h7T7GJNTdQrL758A/PPEvXuB7eEqPffuCVEpR1UpQM9oZVWleudyP2+PWaimg20YQPD6tEfhVuZxX/tsYH+11l9J6wOxW2Lft8eM9FGFYK4A1t1COIGr3GHxarDlNWI0y840xoBaxHELcKkvxH25xVmrIMf1rITDKwShD6XMNwSusNP0CYcptd3wrpTwnQP9kQuYLgcpsulDYdDvEWoX0B5EXBQgc8x8AqMok/4aQ032WO2rjBhe4xZiXBdwZ5xPHiFvBW7/1tCwxzn0KMcFsthRlvYix3GKYcR7WCzHNr8/EZAaJLhHEqSYbjMYKe9n1Zb2MsMZvIhu0s7QjfvuISy3kjogcHb4fvK5hdxC4pZpze4fgAAAABJRU5ErkJggg==" alt=""/><picture><source type="image/webp" data-srcset="/static/cf5756da52d72de079836c9f22c8f5a6/a3a09/2022-11-25-thumbnail.webp 192w,/static/cf5756da52d72de079836c9f22c8f5a6/5358b/2022-11-25-thumbnail.webp 384w,/static/cf5756da52d72de079836c9f22c8f5a6/81e8e/2022-11-25-thumbnail.webp 768w" sizes="(min-width: 768px) 768px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 768px) 768px, 100vw" decoding="async" loading="lazy" data-src="/static/cf5756da52d72de079836c9f22c8f5a6/9b7d7/2022-11-25-thumbnail.png" data-srcset="/static/cf5756da52d72de079836c9f22c8f5a6/5d231/2022-11-25-thumbnail.png 192w,/static/cf5756da52d72de079836c9f22c8f5a6/e1116/2022-11-25-thumbnail.png 384w,/static/cf5756da52d72de079836c9f22c8f5a6/9b7d7/2022-11-25-thumbnail.png 768w" alt="thumbnail"/></picture><noscript><picture><source type="image/webp" srcSet="/static/cf5756da52d72de079836c9f22c8f5a6/a3a09/2022-11-25-thumbnail.webp 192w,/static/cf5756da52d72de079836c9f22c8f5a6/5358b/2022-11-25-thumbnail.webp 384w,/static/cf5756da52d72de079836c9f22c8f5a6/81e8e/2022-11-25-thumbnail.webp 768w" sizes="(min-width: 768px) 768px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 768px) 768px, 100vw" decoding="async" loading="lazy" src="/static/cf5756da52d72de079836c9f22c8f5a6/9b7d7/2022-11-25-thumbnail.png" srcSet="/static/cf5756da52d72de079836c9f22c8f5a6/5d231/2022-11-25-thumbnail.png 192w,/static/cf5756da52d72de079836c9f22c8f5a6/e1116/2022-11-25-thumbnail.png 384w,/static/cf5756da52d72de079836c9f22c8f5a6/9b7d7/2022-11-25-thumbnail.png 768w" alt="thumbnail"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div><style data-emotion="css hgv96i">.css-hgv96i{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:768px;height:100%;margin:0 auto;padding:60px 0;color:#ffffff;}@media (max-width: 768px){.css-hgv96i{width:100%;padding:40px 20px;}}</style><div class="css-hgv96i"><style data-emotion="css 1jbtedb">.css-1jbtedb{display:grid;place-items:center;width:40px;height:40px;border-radius:50%;background:#ffffff;color:#000000;font-size:22px;cursor:pointer;box-shadow:0 0 10px rgba(0, 0, 0, 0.3);}@media (max-width: 768px){.css-1jbtedb{width:30px;height:30px;font-size:18px;}}</style><div class="css-1jbtedb"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="arrow-left" class="svg-inline--fa fa-arrow-left " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.2 288 416 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0L214.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"></path></svg></div><style data-emotion="css 19jc57v">.css-19jc57v{display:-webkit-box;overflow:hidden;overflow-wrap:break-word;margin-top:auto;text-overflow:ellipsis;white-space:normal;-webkit-line-clamp:2;-webkit-box-orient:vertical;font-size:45px;font-weight:800;}@media (max-width: 768px){.css-19jc57v{font-size:30px;}}</style><div class="css-19jc57v">aws-mwaa-configuration-xcom-backend-issue</div><style data-emotion="css y1wqh9">.css-y1wqh9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-top:10px;font-size:18px;font-weight:700;}@media (max-width: 768px){.css-y1wqh9{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;font-size:15px;font-weight:400;}}</style><div class="css-y1wqh9"><div>AWS / MWAA / Airflow / airflow.cfg / xcom / xcom_backend</div><div>2022.11.25.</div></div></div></div><style data-emotion="css 1h2osxm">.css-1h2osxm{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:768px;margin:0 auto;padding:100px 0;word-break:break-all;line-height:1.8;font-size:16px;font-weight:400;}.css-1h2osxm p{padding:3px 0;}.css-1h2osxm h1,.css-1h2osxm h2,.css-1h2osxm h3{font-weight:800;margin-bottom:30px;}.css-1h2osxm *+h1,.css-1h2osxm *+h2,.css-1h2osxm *+h3{margin-top:80px;}.css-1h2osxm hr+h1,.css-1h2osxm hr+h2,.css-1h2osxm hr+h3{margin-top:0;}.css-1h2osxm h1{font-size:30px;}.css-1h2osxm h2{font-size:25px;}.css-1h2osxm h3{font-size:20px;}.css-1h2osxm blockquote{margin:30px 0;padding:5px 15px;border-left:2px solid #000000;font-weight:800;}.css-1h2osxm ol,.css-1h2osxm ul{margin-left:20px;padding:30px 0;}.css-1h2osxm hr{border:1px solid #000000;margin:100px 0;}.css-1h2osxm a{color:#4263eb;-webkit-text-decoration:underline;text-decoration:underline;}.css-1h2osxm pre[class*='language-']{margin:30px 0;padding:15px;font-size:15px;}.css-1h2osxm pre[class*='language-']::-webkit-scrollbar-thumb{background:rgba(255, 255, 255, 0.5);border-radius:3px;}.css-1h2osxm code[class*='language-'],.css-1h2osxm pre[class*='language-']{tab-size:2;}@media (max-width: 768px){.css-1h2osxm{width:100%;padding:80px 20px;line-height:1.6;font-size:14px;}.css-1h2osxm h1{font-size:23px;}.css-1h2osxm h2{font-size:20px;}.css-1h2osxm h3{font-size:17px;}.css-1h2osxm img{width:100%;}.css-1h2osxm hr{margin:50px 0;}}</style><div class="css-1h2osxm"><h2>문제</h2>
<ul>
<li>AWS MWAA <code class="language-text">airflow.cfg</code>에 custom xcom backend를 등록하기 위해 <code class="language-text">core.xcom_backend:include.s3_xcom_backend.S3XComBackend</code> 적용 시
클러스터 업데이트 실패</li>
</ul>
<h2>해결</h2>
<h3>1. airflow.cfg 옵션 변경 실패에 대한 디버깅</h3>
<ol>
<li>
<p>이슈 재현</p>
<ul>
<li>
<p>local에 mwaa 환경 구축 후 <code class="language-text">core.xcom_backend:include.s3_xcom_backend.S3XComBackend</code> 적용시 클러스터 상태 확인</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/91773868639b32eddb0544cd10f8efe6/cc39a/2022-11-25-1.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 11.458333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAYUlEQVR42jWNSwoAIQxDZdyI35lStH7uf80MLbgIfUkDcTQXCjN8CHi8R0oJOWdTKQW1VmO9lzVXKWs/xmg/ZfeK4NsbicgKRIS1FsYY6L1jzmleRMxrrrr+nANmRmvNRn6Spi/AbsSBvAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/91773868639b32eddb0544cd10f8efe6/a59e9/2022-11-25-1.webp 192w,
/static/91773868639b32eddb0544cd10f8efe6/0ca9f/2022-11-25-1.webp 384w,
/static/91773868639b32eddb0544cd10f8efe6/dc9b9/2022-11-25-1.webp 768w,
/static/91773868639b32eddb0544cd10f8efe6/e2c2f/2022-11-25-1.webp 1152w,
/static/91773868639b32eddb0544cd10f8efe6/f3efb/2022-11-25-1.webp 1536w,
/static/91773868639b32eddb0544cd10f8efe6/ea9c0/2022-11-25-1.webp 1694w"
              sizes="(max-width: 768px) 100vw, 768px"
              type="image/webp"
            />
          <source
            srcset="/static/91773868639b32eddb0544cd10f8efe6/3b721/2022-11-25-1.png 192w,
/static/91773868639b32eddb0544cd10f8efe6/66595/2022-11-25-1.png 384w,
/static/91773868639b32eddb0544cd10f8efe6/fe486/2022-11-25-1.png 768w,
/static/91773868639b32eddb0544cd10f8efe6/d2d74/2022-11-25-1.png 1152w,
/static/91773868639b32eddb0544cd10f8efe6/e8464/2022-11-25-1.png 1536w,
/static/91773868639b32eddb0544cd10f8efe6/cc39a/2022-11-25-1.png 1694w"
            sizes="(max-width: 768px) 100vw, 768px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/91773868639b32eddb0544cd10f8efe6/fe486/2022-11-25-1.png"
            alt="2022 11 25 1"
            title=""
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
</li>
<li>
<p><code class="language-text">AirflowConfigException: The object could not be loaded</code> 확인</p>
</li>
<li>
<p>MWAA에서는 Config 실패로 인한 retry 등으로 API Timeout이 날 때 까지 오랜 시간 Cluster 상태가 <code class="language-text">Updating</code>일 수 있습니다.</p>
</li>
</ul>
</li>
<li>
<p>기본 값 적용시 내용 확인</p>
<ul>
<li>
<p><code class="language-text">"core.xcom_backend": "airflow.models.xcom.BaseXCom"</code></p>
<p>→ 성공</p>
<p>→ Value값에 참조할 수 없는 값이 들어가면 실패하는 것을 유추할 수 있습니다</p>
</li>
</ul>
</li>
<li>
<p><code class="language-text">dags/</code> 폴더에 <code class="language-text">s3_xcom_backend.py</code> 파일 생성 후 configuration 적용</p>
<ul>
<li><code class="language-text">"core.xcom_backend": "s3_xcom_backend.S3XComBackend"</code></li>
</ul>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/da1565b98e649d621da24c378012c31d/2561a/2022-11-25-2.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 14.583333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAdklEQVR42l2MSw7DIAwFc/9jQqWQqmAWELD5vMpJFyWWZvM8ms3aFxRjLYyxON4flMqotS4wM1juvTx+/2z77uDcgUCElBLyeYJZ7sAPEUHOGSEQSinovaO1BpbVUzaVFBX05pwYYyzopiHv/eUSEWKMV/jpfgHL4uidMIZ84gAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/da1565b98e649d621da24c378012c31d/a59e9/2022-11-25-2.webp 192w,
/static/da1565b98e649d621da24c378012c31d/0ca9f/2022-11-25-2.webp 384w,
/static/da1565b98e649d621da24c378012c31d/dc9b9/2022-11-25-2.webp 768w,
/static/da1565b98e649d621da24c378012c31d/e2c2f/2022-11-25-2.webp 1152w,
/static/da1565b98e649d621da24c378012c31d/f490a/2022-11-25-2.webp 1180w"
              sizes="(max-width: 768px) 100vw, 768px"
              type="image/webp"
            />
          <source
            srcset="/static/da1565b98e649d621da24c378012c31d/3b721/2022-11-25-2.png 192w,
/static/da1565b98e649d621da24c378012c31d/66595/2022-11-25-2.png 384w,
/static/da1565b98e649d621da24c378012c31d/fe486/2022-11-25-2.png 768w,
/static/da1565b98e649d621da24c378012c31d/d2d74/2022-11-25-2.png 1152w,
/static/da1565b98e649d621da24c378012c31d/2561a/2022-11-25-2.png 1180w"
            sizes="(max-width: 768px) 100vw, 768px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/da1565b98e649d621da24c378012c31d/fe486/2022-11-25-2.png"
            alt="2022 11 25 2"
            title=""
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>→ <strong>성공</strong></p>
</li>
</ol>
<h3>2. MWAA Managed Node 접근 방법이 있을까?</h3>
<ul>
<li>
<p>Managed service이고 내부적으로 <code class="language-text">Amazon ECS on Fargate</code>로 동작하기 때문에 airflow가 설치된 host의 shell로 접근할 수 있는 방법은 현재 존재하지 않습니다.</p>
</li>
<li>
<p>MWAA Architecture</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/40f9830c01782fdc7a0a6c676e49bb3c/adb12/2022-11-25-3.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 57.8125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACX0lEQVR42o2T3U8TQRTF+3f6NxifeEYSE40P+qbRaAzGCMEXMBExGj8DAlEkYCmkpbRQSj92t7vd3e52Pn9mp8UHo4mT3OTuztwz595zpuQFIYMoph8MODlr0/MDl1/0PJeHw5j/XdZaSnuVQ8pHNeqNFvuVGtX6KdXjJgdHxy7qzRZKSowyiHHOOM9QQqKEQiuNkYq82UWnuQMt/WhsMEwjwFze8+e9SC1c9vNsh7rXmv7XKCOR+ZjDuSck5cYEsDgaV7c5e3aVi5e38D/cx9gJfPfjPJ2V6wyzEX4gSLMM1d6hcuDzaMFjNFYOpGBbMHWARWHunRPurtHZXuV0a5VcarcZn+wzPPhEmMT06n2SMCasfWV9vcGNO4dEcYZNE4zSWDPpsKSNYZwMCGrbv5uUsY9X/oB3vEPWOcJazfnd24zKe5MhmAmbcTTg5MYcqtWaimIoFUl0uMHxvSuIuE8xgqj2nebTa5wuzdJZnsUfhlQ3KwT9AV6nxcXiDH51kyDOON+tEXQ9lJq2nOcSLQQiCkjijGE6Ig4TVBqj85TUHxIEKclIkwmF1+tQe/WAbn2fVCiSxJCmGVrKCWCvmyK0Js8NYV84tT0vJ5MaITXtds4gSJz2yhq01hRctLVoJSfuMBarpzNsPFwh/XLAadTg8eubGCyt+TUG736gVUL7+YyzzsXiEv7KsisyQmCUcmJchi1AC8D6+228coNG74zlzy9I5Zjq2y1a3yoko5jymwWiNOHk02ea6xsTt1r7F7dOX8rlhxTKsZdSOmFEYWilGRd7Urk2lVPYuMJ/xS8SI4bG0FnKlwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/40f9830c01782fdc7a0a6c676e49bb3c/a59e9/2022-11-25-3.webp 192w,
/static/40f9830c01782fdc7a0a6c676e49bb3c/0ca9f/2022-11-25-3.webp 384w,
/static/40f9830c01782fdc7a0a6c676e49bb3c/dc9b9/2022-11-25-3.webp 768w,
/static/40f9830c01782fdc7a0a6c676e49bb3c/66318/2022-11-25-3.webp 970w"
              sizes="(max-width: 768px) 100vw, 768px"
              type="image/webp"
            />
          <source
            srcset="/static/40f9830c01782fdc7a0a6c676e49bb3c/3b721/2022-11-25-3.png 192w,
/static/40f9830c01782fdc7a0a6c676e49bb3c/66595/2022-11-25-3.png 384w,
/static/40f9830c01782fdc7a0a6c676e49bb3c/fe486/2022-11-25-3.png 768w,
/static/40f9830c01782fdc7a0a6c676e49bb3c/adb12/2022-11-25-3.png 970w"
            sizes="(max-width: 768px) 100vw, 768px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/40f9830c01782fdc7a0a6c676e49bb3c/fe486/2022-11-25-3.png"
            alt="2022 11 25 3"
            title=""
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
</li>
</ul>
<h3>3. Airflow Configuration 변경 방법</h3>
<ul>
<li>
<p>현재 MWAA에서는 airflow.cfg를 <strong>직접적</strong>으로 변경할 수 있는 방법을 제공하지 않습니다.</p>
</li>
<li>
<p>가능한 방법은 아래 3가지 입니다.</p>
<ol>
<li><code class="language-text">CFN</code>이나 <code class="language-text">CDK</code>등 <code class="language-text">IaC</code>를 사용하여 생성하거나 업데이트 할 때 옵션 반영
<ul>
<li><code class="language-text">AirflowConfigurationOptions</code></li>
</ul>
</li>
<li>WEB UI를 통한 방법</li>
</ol>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/3da0fafcf2733f560f8cc20d16daa2c4/18baa/2022-11-25-4.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 32.8125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA9ElEQVR42pWRCU/DMAyF8///G9dAHVq5hbS1SXOMHG2a9IFTuo1JIBHp03MUy/aLWR8ChhjR9z2GYfhBjHHWcURKGTkn5JyR0qynMSnBLi6vUNcPuL5ZYXV7h/X6vuhmU+Px6RlVVeF9y2E+HLx3sM7BfWOtPcTO+zIAe3l9AxcCSml0UkJpDSkVpDpi9vvyTtBda1NUiA7GmJJPOo4jmPdnlslmjKUbvfkQEEIotoAJ03SEzqKLbSY6iZYLNC1H03BwLsq9kwrWzlaIueDfh3IYjb1r2lJku2tKTMXJHnVcpliW8BuHpZxu7DyB/uQ/pK8JPwEIyh3BrcK6EAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/3da0fafcf2733f560f8cc20d16daa2c4/a59e9/2022-11-25-4.webp 192w,
/static/3da0fafcf2733f560f8cc20d16daa2c4/0ca9f/2022-11-25-4.webp 384w,
/static/3da0fafcf2733f560f8cc20d16daa2c4/dc9b9/2022-11-25-4.webp 768w,
/static/3da0fafcf2733f560f8cc20d16daa2c4/fb49c/2022-11-25-4.webp 785w"
              sizes="(max-width: 768px) 100vw, 768px"
              type="image/webp"
            />
          <source
            srcset="/static/3da0fafcf2733f560f8cc20d16daa2c4/3b721/2022-11-25-4.png 192w,
/static/3da0fafcf2733f560f8cc20d16daa2c4/66595/2022-11-25-4.png 384w,
/static/3da0fafcf2733f560f8cc20d16daa2c4/fe486/2022-11-25-4.png 768w,
/static/3da0fafcf2733f560f8cc20d16daa2c4/18baa/2022-11-25-4.png 785w"
            sizes="(max-width: 768px) 100vw, 768px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/3da0fafcf2733f560f8cc20d16daa2c4/fe486/2022-11-25-4.png"
            alt="2022 11 25 4"
            title=""
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<ol start="3">
<li>AWS-CLI를 통한 방법</li>
</ol>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># update configuration</span>
aws mwaa update-environment <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> xcom_backend_test <span class="token punctuation">\</span>
--airflow-configuration-options <span class="token string">""</span>"<span class="token punctuation">{</span>
  <span class="token punctuation">\</span>"scheduler.dag_dir_list_interval<span class="token punctuation">\</span>": <span class="token punctuation">\</span>"5<span class="token punctuation">\</span>",
  <span class="token punctuation">\</span>"scheduler.min_file_process_interval<span class="token punctuation">\</span>": <span class="token punctuation">\</span>"5<span class="token punctuation">\</span>",
  <span class="token punctuation">\</span>"webserver.expose_config<span class="token punctuation">\</span>": <span class="token punctuation">\</span>"True<span class="token punctuation">\</span>"
  <span class="token punctuation">}</span><span class="token string">""</span>"
  ``<span class="token variable"><span class="token variable">`</span>

<span class="token variable">`</span></span>``bash
<span class="token comment">#!/bin/bash</span>
<span class="token comment"># check configuration</span>
aws mwaa get-environment <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> xcom_backend_test <span class="token operator">|</span> <span class="token punctuation">\</span>
jq <span class="token parameter variable">-r</span> <span class="token string">'.Environment.AirflowConfigurationOptions'</span></code></pre></div>
</li>
</ul>
<h3>4. AWS-MWAA-LOCAL-RUNNER</h3>
<ul>
<li>
<p>MWAA 환경에 직접적인 접근은 어렵지만, <a href="https://github.com/aws/aws-mwaa-local-runner" target="_blank" rel="nofollow">aws-mwaa-local-runner</a>를 통해 local에 MWAA를
mocking하여 테스트를 할 수 있습니다.</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token number">1</span>. /aws-mwaa-local-runner/docker/config/airflow.cfg 변경
<span class="token number">2</span>. ./mwaa-local-env build-image
<span class="token number">3</span>. ./mwaa-local-env start
<span class="token number">4</span>. airflow.cfg 반영 확인</code></pre></div>
</li>
</ul>
<h3>5. 현재 MWAA에 적용된 airflow.cfg 값 및 환경변수 확인 방법</h3>
<ul>
<li>여기에는 몇가지 방법이 있을 수 있습니다.</li>
</ul>
<ol>
<li>환경변수에서 확인</li>
</ol>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> __future__ <span class="token keyword">import</span> annotations

<span class="token keyword">import</span> logging
<span class="token keyword">import</span> os
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime<span class="token punctuation">,</span> timedelta

<span class="token keyword">from</span> airflow <span class="token keyword">import</span> DAG
<span class="token keyword">from</span> airflow<span class="token punctuation">.</span>operators<span class="token punctuation">.</span>python <span class="token keyword">import</span> PythonOperator

logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

<span class="token keyword">with</span> DAG<span class="token punctuation">(</span>
<span class="token string">'get_env_var'</span><span class="token punctuation">,</span>
default_args<span class="token operator">=</span><span class="token punctuation">{</span>
  <span class="token string">'depends_on_past'</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span>
  <span class="token string">'retries'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token string">'retry_delay'</span><span class="token punctuation">:</span> timedelta<span class="token punctuation">(</span>minutes<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  description<span class="token operator">=</span><span class="token string">'check mwaa configuration'</span><span class="token punctuation">,</span>
  start_date<span class="token operator">=</span>datetime<span class="token punctuation">(</span><span class="token number">2022</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  catchup<span class="token operator">=</span><span class="token boolean">False</span>
  <span class="token punctuation">)</span> <span class="token keyword">as</span> dag<span class="token punctuation">:</span>
  <span class="token keyword">def</span> <span class="token function">print_env_vars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  keys <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>environ<span class="token punctuation">)</span>
  <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> keys<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span>k<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>v<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

get_env_vars_operator <span class="token operator">=</span> PythonOperator<span class="token punctuation">(</span>
task_id<span class="token operator">=</span><span class="token string">'get_env_vars_task'</span><span class="token punctuation">,</span>
python_callable<span class="token operator">=</span>print_env_vars
<span class="token punctuation">)</span></code></pre></div>
<ol start="2">
<li>airflow.cfg 파일에서 확인</li>
</ol>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> __future__ <span class="token keyword">import</span> annotations

<span class="token keyword">import</span> logging
<span class="token keyword">import</span> os
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime<span class="token punctuation">,</span> timedelta

<span class="token keyword">from</span> airflow <span class="token keyword">import</span> DAG
<span class="token keyword">from</span> airflow<span class="token punctuation">.</span>operators<span class="token punctuation">.</span>python <span class="token keyword">import</span> PythonOperator

logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

<span class="token keyword">with</span> DAG<span class="token punctuation">(</span>
<span class="token string">'get_airflow_cfg_file'</span><span class="token punctuation">,</span>
default_args<span class="token operator">=</span><span class="token punctuation">{</span>
  <span class="token string">'depends_on_past'</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span>
  <span class="token string">'retries'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token string">'retry_delay'</span><span class="token punctuation">:</span> timedelta<span class="token punctuation">(</span>minutes<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  description<span class="token operator">=</span><span class="token string">'check mwaa configuration'</span><span class="token punctuation">,</span>
  start_date<span class="token operator">=</span>datetime<span class="token punctuation">(</span><span class="token number">2022</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  catchup<span class="token operator">=</span><span class="token boolean">False</span>
  <span class="token punctuation">)</span> <span class="token keyword">as</span> dag<span class="token punctuation">:</span>
  <span class="token keyword">def</span> <span class="token function">print_airflow_cfg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">'AIRFLOW_HOME'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">/airflow.cfg"</span></span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> airflow_cfg<span class="token punctuation">:</span>
  file_contents <span class="token operator">=</span> airflow_cfg<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'\n</span><span class="token interpolation"><span class="token punctuation">{</span>file_contents<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

get_airflow_cfg_operator <span class="token operator">=</span> PythonOperator<span class="token punctuation">(</span>
task_id<span class="token operator">=</span><span class="token string">'get_airflow_cfg_task'</span><span class="token punctuation">,</span>
python_callable<span class="token operator">=</span>print_airflow_cfg
<span class="token punctuation">)</span></code></pre></div>
<ol start="3">
<li>airflow.configuration.conf 확인</li>
</ol>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> __future__ <span class="token keyword">import</span> annotations

<span class="token keyword">import</span> logging
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime<span class="token punctuation">,</span> timedelta

<span class="token keyword">from</span> airflow <span class="token keyword">import</span> DAG
<span class="token keyword">from</span> airflow<span class="token punctuation">.</span>configuration <span class="token keyword">import</span> conf
<span class="token keyword">from</span> airflow<span class="token punctuation">.</span>operators<span class="token punctuation">.</span>python <span class="token keyword">import</span> PythonOperator

logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

<span class="token keyword">with</span> DAG<span class="token punctuation">(</span>
<span class="token string">'get_airflow_cfg'</span><span class="token punctuation">,</span>
default_args<span class="token operator">=</span><span class="token punctuation">{</span>
  <span class="token string">'depends_on_past'</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span>
  <span class="token string">'retries'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token string">'retry_delay'</span><span class="token punctuation">:</span> timedelta<span class="token punctuation">(</span>minutes<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  description<span class="token operator">=</span><span class="token string">'check mwaa configuration'</span><span class="token punctuation">,</span>
  start_date<span class="token operator">=</span>datetime<span class="token punctuation">(</span><span class="token number">2022</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  catchup<span class="token operator">=</span><span class="token boolean">False</span>
  <span class="token punctuation">)</span> <span class="token keyword">as</span> dag<span class="token punctuation">:</span>
  <span class="token keyword">def</span> <span class="token function">get_conf_vars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span>
  <span class="token string-interpolation"><span class="token string">f"AIRFLOW__CORE__XCOM_BACKEND: </span><span class="token interpolation"><span class="token punctuation">{</span>conf<span class="token punctuation">.</span>get<span class="token punctuation">(</span>section<span class="token operator">=</span><span class="token string">'CORE'</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token string">'XCOM_BACKEND'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
  <span class="token punctuation">)</span>

get_conf_vars_operator <span class="token operator">=</span> PythonOperator<span class="token punctuation">(</span>
task_id<span class="token operator">=</span><span class="token string">'get_conf_vars_task'</span><span class="token punctuation">,</span>
python_callable<span class="token operator">=</span>get_conf_vars
<span class="token punctuation">)</span></code></pre></div>
<ol start="4">
<li>MWAA Web UI에서 확인</li>
</ol>
<ul>
<li>진행 과정 요약</li>
<li>“webserver.expose_config”: “True” 값을 먼저 설정합니다.</li>
</ul>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/6fd48288d918c49f49551ce87f38762f/98b00/2022-11-25-5.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 21.354166666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAlElEQVR42o3Myw6CMBSEYd7/0VwZXRBNhCByKQIlkUt72vIbiXuY5Esms5hIKUWe52TZk6IoKKuKcVoQsVh7jDGGZVm2HulhoFYNbdcx/0crgjhBZJ9zjnGc6PWwHUe616ha0TbvjTUGwsrqPasP+0LAiRBC4JdIn650lxvtOeYTJ9jHC5eWxyQFPi2Z7xkmTvFW+AJv4DOLRRxrAAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/6fd48288d918c49f49551ce87f38762f/a59e9/2022-11-25-5.webp 192w,
/static/6fd48288d918c49f49551ce87f38762f/0ca9f/2022-11-25-5.webp 384w,
/static/6fd48288d918c49f49551ce87f38762f/dc9b9/2022-11-25-5.webp 768w,
/static/6fd48288d918c49f49551ce87f38762f/e2c2f/2022-11-25-5.webp 1152w,
/static/6fd48288d918c49f49551ce87f38762f/0da4f/2022-11-25-5.webp 1202w"
              sizes="(max-width: 768px) 100vw, 768px"
              type="image/webp"
            />
          <source
            srcset="/static/6fd48288d918c49f49551ce87f38762f/3b721/2022-11-25-5.png 192w,
/static/6fd48288d918c49f49551ce87f38762f/66595/2022-11-25-5.png 384w,
/static/6fd48288d918c49f49551ce87f38762f/fe486/2022-11-25-5.png 768w,
/static/6fd48288d918c49f49551ce87f38762f/d2d74/2022-11-25-5.png 1152w,
/static/6fd48288d918c49f49551ce87f38762f/98b00/2022-11-25-5.png 1202w"
            sizes="(max-width: 768px) 100vw, 768px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/6fd48288d918c49f49551ce87f38762f/fe486/2022-11-25-5.png"
            alt="2022 11 25 5"
            title=""
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<ul>
<li>MWAA Web UI → Admin → Configuration에 들어갑니다.</li>
</ul>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 612px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/1de3a02c5849803d3512998d399ab815/dbf98/2022-11-25-6.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 31.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABPklEQVR42jWQTYsUMRCG+///EEHYi6AXL3vRg6IiDKi0szg67ux0T3e+pjuTTiV5JFkMVHhDVT15q7rfv068//oZZS3rspByZhxHtm3DWss8z5RSMMaglGpaK4U1hiSCmmckCvXUXPdkVr4NB27eE0Ig54zWuukKrA1J0jN8mkgUrjeP3wIFsMuVBORSSCnRLV4g5ebIe49zDu9XRKTBS8nEGBs0A9ukUbuew4cvuP5APk2EhyPBLUgFfnrYWNaVdV0Zx4G+79nv94jE5vJ/bCG0seL3A8e7t+xevmb34hXD/Ufcm3fIqFq+yzkhktpji9VVafoWIrG6ai5Lq5GckbCh/zzy98dP9PFE0o5kl7bHOnZn3MrTRbfm82Q4DYoowqQd54vmohwp5VYzzhZlF8zVcR5HpDx/Xu/KGSbDP3Muy30LWewFAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/1de3a02c5849803d3512998d399ab815/a59e9/2022-11-25-6.webp 192w,
/static/1de3a02c5849803d3512998d399ab815/0ca9f/2022-11-25-6.webp 384w,
/static/1de3a02c5849803d3512998d399ab815/d408e/2022-11-25-6.webp 612w"
              sizes="(max-width: 612px) 100vw, 612px"
              type="image/webp"
            />
          <source
            srcset="/static/1de3a02c5849803d3512998d399ab815/3b721/2022-11-25-6.png 192w,
/static/1de3a02c5849803d3512998d399ab815/66595/2022-11-25-6.png 384w,
/static/1de3a02c5849803d3512998d399ab815/dbf98/2022-11-25-6.png 612w"
            sizes="(max-width: 612px) 100vw, 612px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/1de3a02c5849803d3512998d399ab815/dbf98/2022-11-25-6.png"
            alt="2022 11 25 6"
            title=""
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<ul>
<li>UI에서 airflow.cfg를 확인합니다</li>
</ul>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/0f4446c8f80891195e7f14d6a90524d8/1745e/2022-11-25-7.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 103.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsTAAALEwEAmpwYAAACqUlEQVR42oVUi3KbMBDk/3+ubdo0wSChN0IYElPHdkKS7dxF8riZceqZHckYLfs4XN3c1VBDxPPxhKenJyzLgt1uh8fHR5xOJ8zTjHVd8fDwgJeXFyy7Be/v77j2qebDAfvTAa/rygdfX18Z6/rCBPQQWg+HA56fn3E8Hvm+a6g60UIIAeccr3Vdo21bSCn5MH2Kosv1GqpxHBFCQEoJ2+2Wib33iDGyfVJGKvf7Pa//AxPSYSKldRiGM/q+P1+jDAnzPH+JapomVkfEtKeVvhdCUkvrkBITlsKuoUpjQhoGjCkxEcl+f3vjkqict3NJK++/KoRLqXWDjepgQ4D2Hi5G+JQ+MAwIn0AqSOU1VMZrNKqBcRZWKSgh0LUtVNNAKQUTAmzf88NoT7FQVtM8n3O9RGWChzAa2jtIbSCI1Bhum3IbKNPt9oyYEoPUEvmSMyUyztDHAcp7hukDdFZEathyjExAxP0FGd2T8jX6rZRVCWtxKyRqpXHfKTTG4E4p1EqxTeUck3c0nzGySiI4K8/rdpo+LPveQlmJzkooq+C1hm4FbKdYic8KXSYrltMnxXQfz6H2BkJLSNOh1R2sc+iM4RxJISlTuRA6TErYPs3pkLicJTfMlkN0cMHABg3vHWLfox9HjNkOHS6KSjFjBu2JsJSSW474sWnwsxX4KQSEc5DO4Vtd43tdY6M1fguJ21bgV9sy8WUEl2Ss0AYDYSRk20LUNZyUcJSjD2zV9T3D5vbLDJL1z7P4Qdh7CGsgtebcKD8XAiug0Ck7HqEY2SblVXD5hhSlFY3KTdN8WNxs2DaNzn3X4U7KM+r81pQZpAcQTH74OE1FIc2YhbRUjIemDHPD5XUrh6dLuxnbjLlYHlKA8Yrhe4PoPYL3LP/Psvxj7au/rWL5Lz1aJ3IDLl3IAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/0f4446c8f80891195e7f14d6a90524d8/a59e9/2022-11-25-7.webp 192w,
/static/0f4446c8f80891195e7f14d6a90524d8/0ca9f/2022-11-25-7.webp 384w,
/static/0f4446c8f80891195e7f14d6a90524d8/dc9b9/2022-11-25-7.webp 768w,
/static/0f4446c8f80891195e7f14d6a90524d8/b22d3/2022-11-25-7.webp 814w"
              sizes="(max-width: 768px) 100vw, 768px"
              type="image/webp"
            />
          <source
            srcset="/static/0f4446c8f80891195e7f14d6a90524d8/3b721/2022-11-25-7.png 192w,
/static/0f4446c8f80891195e7f14d6a90524d8/66595/2022-11-25-7.png 384w,
/static/0f4446c8f80891195e7f14d6a90524d8/fe486/2022-11-25-7.png 768w,
/static/0f4446c8f80891195e7f14d6a90524d8/1745e/2022-11-25-7.png 814w"
            sizes="(max-width: 768px) 100vw, 768px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/0f4446c8f80891195e7f14d6a90524d8/fe486/2022-11-25-7.png"
            alt="2022 11 25 7"
            title=""
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<h2>Summary</h2>
<ul>
<li>MWAA의 세팅 관련 참고할만한 자료입니다.
<ul>
<li><a href="https://catalog.workshops.aws/amazon-mwaa-for-analytics/en-US" target="_blank" rel="nofollow">https://catalog.workshops.aws/amazon-mwaa-for-analytics/en-US</a></li>
<li><a href="https://catalog.workshops.aws/aws-data-ingestion-pipeline/ko-KR" target="_blank" rel="nofollow">https://catalog.workshops.aws/aws-data-ingestion-pipeline/ko-KR</a></li>
</ul>
</li>
<li>xcom_backend의 값으로 <strong>참조 가능한 경로에 파일이 있어야만</strong> 클러스터 정상 업데이트 가능합니다.</li>
<li>airflow.cfg 값을 호스트에 접근하여 직접적으로 변경할 수 있는 방법은 없습니다.</li>
<li>MWAA는 Managed service이기 때문에, 위에 설명드린 방법으로 우회하여 구조 등을 확인하실 수 있습니다.</li>
<li>현재 MWAA에서는 만약 <code class="language-text">잘못된 세팅값</code>으로 클러스터를 업데이트 시키면, 내부 요인에 의해 장시간 클러스터pending 상태가 될 수 있습니다. 이를 대비하는 방법은 아래와 같습니다.
<ul>
<li>aws-mwaa-local-runner로 미리 구성을 확인합니다.</li>
<li>Network or Permission 문제일 수도 있기 때문에 <a href="https://github.com/awslabs/aws-support-tools/tree/master/MWAA" target="_blank" rel="nofollow">링크와</a> 같은 도구를
이용하는 것을 추천 드립니다.</li>
<li>MWAA <code class="language-text">23년 마일스톤</code>으로 클러스터 업데이트 구성 지연 이슈는 해결될 예정입니다.</li>
</ul>
</li>
</ul>
<h2>References</h2>
<ul>
<li><a href="https://programmaticponderings.com/2020/12/29/amazon-managed-workflows-for-apache-airflow-configuration-understanding-amazon-mwaas-configuration-options/" target="_blank" rel="nofollow">https://programmaticponderings.com/2020/12/29/amazon-managed-workflows-for-apache-airflow-configuration-understanding-amazon-mwaas-configuration-options/</a></li>
<li><a href="https://airflow.apache.org/docs/apache-airflow/2.2.2/configurations-ref.html" target="_blank" rel="nofollow">https://airflow.apache.org/docs/apache-airflow/2.2.2/configurations-ref.html</a></li>
<li><a href="https://docs.aws.amazon.com/mwaa/latest/userguide/configuring-env-variables.html#configuring-env-variables-airflow-ref" target="_blank" rel="nofollow">https://docs.aws.amazon.com/mwaa/latest/userguide/configuring-env-variables.html#configuring-env-variables-airflow-ref</a></li>
<li><a href="https://docs.astronomer.io/learn/custom-xcom-backends" target="_blank" rel="nofollow">https://docs.astronomer.io/learn/custom-xcom-backends</a></li>
<li><a href="https://docs.aws.amazon.com/mwaa/latest/userguide/what-is-mwaa.html" target="_blank" rel="nofollow">https://docs.aws.amazon.com/mwaa/latest/userguide/what-is-mwaa.html</a></li>
</ul></div><style data-emotion="css 15zmqn9">@media (max-width: 768px){.css-15zmqn9{padding:0 20px;}}</style><div class="css-15zmqn9"></div><style data-emotion="css 1uoe0u8">.css-1uoe0u8{display:grid;place-items:center;margin-top:auto;padding:50px 0;font-size:15px;text-align:center;line-height:1.5;}@media (max-width: 768px){.css-1uoe0u8{font-size:13px;}}</style><footer class="css-1uoe0u8">Thank you for visiting my blog, Have a good day :)<br/>© 2022 Developer dev-0wner, Powered By Gatsby.</footer></main></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2022-11-25-mwaa-xcom_backend-config/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-5ab7cf9e48a783cbdcc5.js\"],\"component---src-pages-index-tsx\":[\"/component---src-pages-index-tsx-68981569de4d59f6ef38.js\"],\"component---src-pages-info-tsx\":[\"/component---src-pages-info-tsx-804985aaf2205d4b0a67.js\"],\"component---src-templates-post-template-tsx\":[\"/component---src-templates-post-template-tsx-3e70f743219d2dbe7e7d.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="056513f44ec23d94a440";</script><script src="/webpack-runtime-8eb60ee2674ee29239d5.js" async></script><script src="/framework-e00b866f39f81195a42a.js" async></script><script src="/app-5ab7cf9e48a783cbdcc5.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>